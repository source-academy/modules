# The Build Script Command System

The build script command system is primarily powered by the `commander` package, which provides command line argument parsing.
To avoid cluttering code with text, some commands which require more configuration have had their configuration
moved to `command.json` files.

There are four types of output that need to be built:
1. Bundles
2. Tabs
3. Jsons
4. HTML Documentation

Each build order consists of the following steps:

1. Determine which files to build (`getBundles()`)
2. Log which files are about to be built (`logBundleStart()`)
3. Run the appropriate build command (`buildBundles()`)
4. Log the result of the build process (`logBundlesResult()`)

The `build json`, `build tab` and `build html` commands each run their respective build orders.
Bundles cannot be separately as tabs and documentations are reliant on bundles.
To rebuild a bundle, run `build modules`, which will also build the jsons and tabs if their parent bundle is being rebuilt,
along with the html documentation.

You can specify `-f` or `--force` when executing a build command, which will display the reasons why a certain file is being rebuilt.

If no options are specified, then the system will automatically determine which files to build.

## Build Command Output
Because the build commands are run asynchronously, log output becomes jumbled up if plain `console.log` is used. Thus,
logs are gathered in `string[]` and then logged together. Each entry in the array is printed as a separate line.

For example:
```ts
// build modules command
const bundleOpts = await getBundles(opts);
const [tabOpts, jsonOpts] = await Promise.all([getTabs(opt), getJsons(opts)]);

// Logs are all gathered and logged at once to the console
console.log(
  joinArrays('', logBundleStart(bundleOpts), logTabStart(tabOpts), logJsonStart(jsonOpts))
  .join('\n')
)
```

## Bundles
Bundles are rebuilt for the following reasons:
1. A file within its folder has been modified since its last build time
2. Its output file is missing, or the output folder is empty or missing
3. `--force` was specified
4. It was manually specified by `-b`

## Tabs
Tabs are rebuilt for the following reasons:
1. A file within its folder has been modified since its last build time
2. Its output file is missing, or the output folder is empty or missing
3. `--force` was specified
4. It was manually specified by `-t`
5. Its parent bundle is being rebuilt

## Jsons
JSONS are rebuilt for the following reasons:
1. Its parent bundle was modified since its last build time
2. Its output file is missing, or the output folder is empty or missing
3. `--force` was specified
4. It was manually specified by `-j` with the `build all` command, or `-b` with the `build jsons` command
5. Its parent bundle is being rebuilt

Json documentation is first generated by Typedoc to `docs.json`. Then, the file is parsed to extract the documentation
for each exported constant or function, bundle by bundle.

## HTML
HTML documentation is rebuilt if bundles have been modified since the HTML documentation was last built,
or if the documentation is missing from the output folder.

Use `--no-html` with `build all` to prevent HTML from being built.

## Multithreading
The build commands make use of NodeJS `worker_thread`s to speed up the build process. By default, a `worker_thread`
is created for every single tab and bundle being built (I tried using threadpools, but they were all slower).