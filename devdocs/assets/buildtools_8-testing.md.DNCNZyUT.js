import{_ as n,C as o,c as l,o as i,a2 as t,b as h,w as e,a as d,G as p,a3 as r}from"./chunks/framework.BYVJ-AET.js";const b=JSON.parse('{"title":"Testing Using Vitest","description":"","frontmatter":{},"headers":[],"relativePath":"buildtools/8-testing.md","filePath":"buildtools/8-testing.md","lastUpdated":1762847781000}'),c={name:"buildtools/8-testing.md"};function k(g,s,E,u,f,y){const a=o("Mermaid");return i(),l("div",null,[s[1]||(s[1]=t(`<h1 id="testing-using-vitest" tabindex="-1">Testing Using <code>Vitest</code> <a class="header-anchor" href="#testing-using-vitest" aria-label="Permalink to &quot;Testing Using \`Vitest\`&quot;">​</a></h1><p><code>vitest</code> comes with its own <a href="https://vitest.dev/advanced/api/" target="_blank" rel="noreferrer">Node API</a> that can be used to run tests from Node. To reduce the number of configuration files required, the buildtools provide their own default <code>vitest</code> configuration for bundles and tabs. <code>vitest</code> supports a similar concept to workspaces known as <a href="https://vitest.dev/guide/projects.html" target="_blank" rel="noreferrer">projects</a>.</p><details class="details custom-block"><summary><code>vitest</code>&#39;s own configuration utilities</summary><p>We can combine configurations using the <code>mergeConfig</code> helper from <code>vitest/config</code>. This helper doesn&#39;t do anything interesting other than directly combine the options between the two parameters.</p><p>This means that if we attached the projects configuration to the root config file, the project configuration will end up getting copied over to every other child configuration.</p><p>For example, consider the root config file below with one project configured.</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { defineConfig } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;vitest/config&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Root Config</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> defineConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  test: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    projects: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;./sub-project/vitest.config.js&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><p>For the child configuration:</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { defineProject, mergeConfig } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;vitest/config&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> rootConfig </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;../vitest.config.js&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> mergeConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  rootConfig,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  defineProject</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    test: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      name: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Child Project&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><p>The actual configuration that&#39;s actually resolved by <code>vitest</code> actually looks like this:</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> config</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  test: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    name: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Child Project&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    projects: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;./sub-project/vitest.config.js&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span></code></pre></div><p>So if you ran <code>yarn vitest --config ./sub-project/vitest.config.js</code>, <code>vitest</code> would try to locate another <code>vitest</code> project located at <code>./sub-project/sub-project/vitest.config.js</code>. Since the child config is intended to be just that, this is simply incorrect functionality. If that particular configuration file doesn&#39;t exist, <code>vitest</code> wouldn&#39;t even be able to start.</p><p>In the spirit of more closely matching the projects configuration system that <code>jest</code> uses, a lot of code had to be written to get around the way <code>vitest</code> behaves.</p></details><p>The buildtools maintains a set of default configurations. If no <code>vitest</code> configuration is present, then those defaults are used automatically. Otherwise, that configuration is loaded and its options are combined with the default configurations using <code>mergeConfig</code>.</p><details class="details custom-block"><summary>Vite vs Vitest</summary><p><code>vitest</code> is built on top of <code>vite</code>, which is a bundler designed mainly for frontend development. It is used with the devserver for that purpose, but Vitest makes use of Vite to run tests.</p><p>This means that <code>vite</code> is the one primarily handling all the transforms necessary (like processing ESM and JSX), and also module resolution. This is why the <code>vitest</code> configs all have their options under a <code>test</code> object.</p></details><h2 id="config-resolution" tabindex="-1">Config Resolution <a class="header-anchor" href="#config-resolution" aria-label="Permalink to &quot;Config Resolution&quot;">​</a></h2>`,6)),(i(),h(r,null,{default:e(()=>[p(a,{id:"mermaid-46",class:"mermaid",graph:"graph%20TD%0A%20%20A%5BDoes%20this%20directory%20contain%20a%20Vitest%20config%3F%5D%0A%20%20B%5BLoad%20the%20config%20and%20combine%20it%20with%20defaults%5D%0A%20%20C%5BIs%20this%20directory%20a%20tab%20or%20a%20bundle%3F%5D%0A%20%20E%5BLoad%20defaults%5D%0A%20%20D%5BReturn%20Error%5D%0A%20%20I%5BDoes%20this%20bundle%20or%20tab%20have%20tests%3F%5D%0A%20%20F%5BIs%20browser%20mode%20enabled%5D%0A%20%20G%5BProcess%20Browser%20Mode%20Options%5D%0A%20%20H%5BRun%20Vitest%5D%0A%20%20J%5BSkip%20directory%5D%0A%0A%20%20A%20--%20Yes%20--%3E%20B%0A%20%20A%20--%20No%20--%3E%20C%0A%20%20C%20--%20Yes%20--%3E%20I%0A%20%20I%20--%20No%20--%3E%20J%0A%20%20I%20--%20Yes%20--%3E%20E%0A%20%20C%20--%20No%20--%3E%20D%0A%0A%20%20B%20--%3E%20F%0A%20%20E%20--%3E%20F%0A%0A%20%20F%20--%20Yes%20--%3E%20G%0A%20%20F%20--%20No%20--%3E%20H%0A%20%20G%20--%3E%20H%0A"})]),fallback:e(()=>s[0]||(s[0]=[d(" Loading... ")])),_:1})),s[2]||(s[2]=t(`<h3 id="testall-command" tabindex="-1"><code>testall</code> Command <a class="header-anchor" href="#testall-command" aria-label="Permalink to &quot;\`testall\` Command&quot;">​</a></h3><p>The <code>testall</code> command functions slightly differently. The command first checks the root <code>vitest.config.js</code> to identify which directories it should check as a <code>vitest</code> project. For each of those directories, no error will be thrown if the <code>vitest</code> config file is missing, unless that directory also contains test files.</p><p>Bundles and tabs are allowed to be missing a <code>vitest</code> configuration file and still have tests, since the buildtools will automatically provide a default <code>vitest</code> configuration.</p><h2 id="actually-running-vitest-from-node" tabindex="-1">Actually Running <code>vitest</code> from Node <a class="header-anchor" href="#actually-running-vitest-from-node" aria-label="Permalink to &quot;Actually Running \`vitest\` from Node&quot;">​</a></h2><p>The main way to run <code>vitest</code> from Node is via the <a href="https://vitest.dev/advanced/api/#startvitest" target="_blank" rel="noreferrer"><code>startVitest</code></a> function. The documentation for this function is unfortunately a bit lacking, but from what I have figured out, here&#39;s how it works:</p><table tabindex="0"><thead><tr><th></th><th>Parameter</th><th>Type</th><th>Explanation</th></tr></thead><tbody><tr><td>1</td><td>Mode</td><td><code>&#39;bench&#39; | &#39;test&#39;</code></td><td>Vitest Run Mode. Used to distinguish between running tests and benchmarks</td></tr><tr><td>2</td><td>Filters</td><td><code>string[]</code></td><td>Glob paths to filter test files by</td></tr><tr><td>3</td><td>CLI Options</td><td><code>VitestUserConfig</code></td><td>Your actual test options.</td></tr><tr><td>4</td><td>Vite Options</td><td><code>ViteUserConfig</code></td><td>Options for Vite</td></tr><tr><td>5</td><td>Vitest Options</td><td><code>VitestOptions</code></td><td>A configuration object for <code>stdout</code>, <code>stderr</code> and the like.</td></tr></tbody></table><p>That third parameter should be passed a test configuration, rather than the entire Vite config:</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> fullViteConfig</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  test: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    name: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Tests&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Pass this to startVitest instead</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> vitestConfig</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  name: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Tests&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span></code></pre></div><p>You should also pass <code>config: false</code>. Otherwise, <code>vitest</code> will still try to load a <code>vitest</code> configuration file using its own resolution rules:</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">startVitest</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;test&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, [], {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  config: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  ...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">testOptions</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><p>When running tests, you need to actually provide each configuration object as a project:</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">startVitest</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;test&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, [], {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  config: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  projects: [yourTestConfig]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><h2 id="browser-mode" tabindex="-1">Browser Mode <a class="header-anchor" href="#browser-mode" aria-label="Permalink to &quot;Browser Mode&quot;">​</a></h2><p>If browser mode is enabled, the buildtools will automatically reassign the names of projects and the <code>include</code> field will be moved from the <code>test</code> object onto the <code>browser.instance</code> object.</p><p>Headless mode is always enabled, so long as <code>vitest</code> isn&#39;t being run in watch mode.</p>`,15))])}const v=n(c,[["render",k]]);export{b as __pageData,v as default};
