import{_ as l,C as o,c as p,o as h,a2 as t,j as s,G as a,w as n}from"./chunks/framework.BYVJ-AET.js";const r="/modules/devdocs/assets/terminal-coverage.BOCKrUrE.png",d="/modules/devdocs/assets/browser-coverage.CTf6on4G.png",k="/modules/devdocs/assets/uncovered.MU0N2oK5.png",b=JSON.parse('{"title":"Testing Overview","description":"","frontmatter":{},"headers":[],"relativePath":"modules/4-testing/4-unit/1-general.md","filePath":"modules/4-testing/4-unit/1-general.md","lastUpdated":1762851639000}'),c={name:"modules/4-testing/4-unit/1-general.md"};function g(u,i,y,E,v,F){const e=o("nobr");return h(),p("div",null,[i[13]||(i[13]=t(`<h1 id="testing-overview" tabindex="-1">Testing Overview <a class="header-anchor" href="#testing-overview" aria-label="Permalink to &quot;Testing Overview&quot;">​</a></h1><p>The testing library used by this repository is <a href="https://vitest.dev" target="_blank" rel="noreferrer"><code>vitest</code></a>.</p><h2 id="running-tests" tabindex="-1">Running Tests <a class="header-anchor" href="#running-tests" aria-label="Permalink to &quot;Running Tests&quot;">​</a></h2><p>To run tests for a given bundle or tab, simply run either of the following commands within the directory:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">yarn</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> buildtools</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --project</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">yarn</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # If your package.json has this script specified</span></span></code></pre></div><p>You can further specify file and folder paths and patterns to filter which test files you&#39;d like to execute:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">yarn</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> src/__tests__/</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">yarn</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> src/__tests__/functions.test.ts</span></span></code></pre></div><p>These filters can be either POSIX or Windows style paths.</p><p>For bundles and tabs, the test environment should always be <code>jsdom</code>, since they are intended for the browser.</p><div class="warning custom-block github-alert"><p class="custom-block-title">Dependency Optimization Error</p><p>You may find that when your tests run on your local machine the following warning (or something similar) may appear:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[vite] (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">client</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) ✨ new dependencies optimized: react/jsx-dev-runtime  </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[vite] (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">client</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) ✨ optimized dependencies changed. reloading  </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[vitest] Vite unexpectedly reloaded a test. This may cause tests to fail, lead to flaky behaviour or duplicated test runs.  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">For</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> stable</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> experience,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> please</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> add</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mentioned</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dependencies</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> your</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> config&#39;s \`optimizeDeps.include\` field manually.</span></span></code></pre></div><p>If this warning appears when you run your tests on the machine, you may find that your tests may still pass on the local machine, but fail on the CI pipeline.</p><p>This is because you have a dependency that Vite can only detect at runtime and so has to run its internal transforms twice. This causes Vitest to fail, since the original import would have failed. To fix this, you should create your own <code>vitest.config.ts</code> and add those dependencies to <code>optimizeDeps</code>:</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> defineProject</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  optimizeDeps: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    include: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;react/jsx-dev-runtime&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  test: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    name: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Root Project&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><p>For more information, refer to the <a href="https://vite.dev/config/dep-optimization-options.html#optimizedeps-include" target="_blank" rel="noreferrer">Vite</a> documentation.</p></div><h3 id="options-cheatsheet" tabindex="-1">Options Cheatsheet <a class="header-anchor" href="#options-cheatsheet" aria-label="Permalink to &quot;Options Cheatsheet&quot;">​</a></h3>`,11)),s("table",null,[i[12]||(i[12]=s("thead",null,[s("tr",null,[s("th",null,"Option"),s("th",null,"Description"),s("th",null,"Values")])],-1)),s("tbody",null,[i[10]||(i[10]=s("tr",null,[s("td",null,[s("code",null,"--watch")]),s("td",null,"Run tests in watch mode"),s("td")],-1)),i[11]||(i[11]=s("tr",null,[s("td",null,[s("code",null,"--update")]),s("td",null,"Cause snapshots to be updated"),s("td")],-1)),s("tr",null,[s("td",null,[a(e,null,{default:n(()=>i[0]||(i[0]=[s("code",null,"--coverage",-1)])),_:1,__:[0]})]),i[1]||(i[1]=s("td",null,"Calculate and produce code coverage report",-1)),i[2]||(i[2]=s("td",null,null,-1))]),s("tr",null,[i[8]||(i[8]=s("td",null,[s("code",null,"--silent")],-1)),i[9]||(i[9]=s("td",null,"Controls whether Vitest should print any messages that were logged during tests",-1)),s("td",null,[i[4]||(i[4]=s("code",null,"true",-1)),i[5]||(i[5]=s("br",null,null,-1)),i[6]||(i[6]=s("code",null,"false",-1)),i[7]||(i[7]=s("br",null,null,-1)),a(e,null,{default:n(()=>i[3]||(i[3]=[s("code",null,"passed-only",-1)])),_:1,__:[3]})])])])]),i[14]||(i[14]=t('<h2 id="coverage" tabindex="-1">Coverage <a class="header-anchor" href="#coverage" aria-label="Permalink to &quot;Coverage&quot;">​</a></h2><p>Test coverage broadly refers to the how much of your code&#39;s functionality is covered by your unit tests as a way of identifying things that might need to be tested.</p><p>You can generate a coverage report for your tests by running <code>yarn test --coverage</code>. There are several metrics by which code coverage is measured when using <code>vitest</code>, namely statements, branches, lines and functions.</p><div class="warning custom-block github-alert"><p class="custom-block-title">WARNING</p><p>Coverage reports might not be generated if your any of your tests fail.</p></div><p>The coverage report is printed out to the terminal: <img src="'+r+'" alt=""></p><p>and can also be viewed as a HTML report using your browser: <img src="'+d+'" alt=""></p><p>The browser report is also able to show you exactly what parts of your code remain uncovered by testing: <img src="'+k+`" alt=""></p><p>Right now, there isn&#39;t a coverage threshold in place (i.e your tests won&#39;t be considered passed if your overall coverage is too low), but there may be one in the future, and anyways high code coverage is good practice.</p><h3 id="ignoring-files-for-coverage" tabindex="-1">Ignoring Files for Coverage <a class="header-anchor" href="#ignoring-files-for-coverage" aria-label="Permalink to &quot;Ignoring Files for Coverage&quot;">​</a></h3><p>There might be functionality that&#39;s completely impossible to test. For example, if we tried to mock the <code>vitest</code> utilities, the <code>vitest</code> instance running our tests would break:</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// This test won&#39;t be able to execute!</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { foo } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;../functions&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> *</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> vitest </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;vitest&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">vitest.vi.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">spyOn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(vitest, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;test&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">vitest.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">describe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;A test suite&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  vitest.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Expect test to be called&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    foo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    vitest.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">expect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(vitest.test).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toHaveBeenCalledOnce</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><p>In such a case you can use an <code>ignore</code> directive to instruct <code>vitest</code> to ignore the given lines or files when determining coverage:</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/* v8 ignore start */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> foo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // This function won&#39;t be considered for code coverage.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/* v8 ignore stop */</span></span></code></pre></div><p>More information can be found <a href="https://github.com/istanbuljs/v8-to-istanbul#ignoring-uncovered-lines" target="_blank" rel="noreferrer">here</a></p><h2 id="custom-test-configuration" tabindex="-1">Custom Test Configuration <a class="header-anchor" href="#custom-test-configuration" aria-label="Permalink to &quot;Custom Test Configuration&quot;">​</a></h2><p>You don&#39;t need to create a custom <code>vitest.config.ts</code> for your bundle or tab. If the configuration file is absent, the default testing configuration options will be applied.</p><p>If you find that the default test configuration is insufficient for your needs, simply create your own <code>vitest.config.ts</code> at the root of your bundle/tab. The configuration options in your <code>vitest.config.ts</code> will be used <strong>in addition</strong> to the default options, so it is not necessary to redefine every single option in your configuration file.</p><p>You should use the <code>defineProject</code> helper instead of the <code>defineConfig</code> helper:</p><div class="vp-code-block-title"><div class="vp-code-block-title-bar"><span class="vp-code-block-title-text" data-title="vitest.config.ts">vitest.config.ts</span></div><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { defineProject } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;vitest/config&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> defineProject</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  test: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    root: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">meta</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.dirname,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    name: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;My Bundle&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Remember to configure this correctly</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div></div><p>It is important that you set the <code>name</code> property correctly, as Vitest projects cannot have conflicting names.</p><div class="info custom-block github-alert"><p class="custom-block-title">INFO</p><p>Some paths are automatically excluded from both testing and test coverage. Paths like <code>**/dist/**</code> are only intended for containing build artifacts which do not need to be tested.</p><p>Therefore, it is unnecessary to exclude such paths in your own custom test configuration. In general, it is unnecessary to configure the <code>exclude</code> property unless you&#39;re noticing that Vitest is incorrectly detecting files as test files and incorrectly including files in coverage reports.</p></div><p>You should <strong>not</strong> be including <code>vitest.config.ts</code> in your <code>tsconfig.json</code>.</p><h2 id="integration-with-git-hooks" tabindex="-1">Integration with Git Hooks <a class="header-anchor" href="#integration-with-git-hooks" aria-label="Permalink to &quot;Integration with Git Hooks&quot;">​</a></h2><p>Any tests that you have written must be pass in order for you to push to the main repository, as well as for your pull requests to be merged.</p><div class="tip custom-block github-alert"><p class="custom-block-title">TIP</p><p>You can push to the branch while bypassing the Git hook by running:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> push</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --no-verify</span></span></code></pre></div><p>However, the tests will still be run and must pass before your pull request can be merged. So, we recommend not using this option unless absolutely necessary.</p></div>`,25))])}const m=l(c,[["render",g]]);export{b as __pageData,m as default};
