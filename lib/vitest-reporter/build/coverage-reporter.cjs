"use strict";var b=Object.create;var o=Object.defineProperty;var g=Object.getOwnPropertyDescriptor;var y=Object.getOwnPropertyNames;var v=Object.getPrototypeOf,k=Object.prototype.hasOwnProperty;var S=(t,e)=>{for(var n in e)o(t,n,{get:e[n],enumerable:!0})},p=(t,e,n,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of y(e))!k.call(t,s)&&s!==n&&o(t,s,{get:()=>e[s],enumerable:!(r=g(e,s))||r.enumerable});return t};var f=(t,e,n)=>(n=t!=null?b(v(t)):{},p(e||!t||!t.__esModule?o(n,"default",{value:t,enumerable:!0}):n,t)),E=t=>p(o({},"__esModule",{value:!0}),t);var F={};S(F,{default:()=>a});module.exports=E(F);var d=f(require("fs"),1),w=f(require("istanbul-lib-report"),1);function R(t){return t.statements.pct===100&&t.branches.pct===100&&t.functions.pct===100&&t.lines.pct===100}function L(t){if(t.isSummary())return[];let e=t.getCoverageSummary(!1),r=e.isEmpty()?0:e.lines.pct,s,m=t.getFileCoverage();if(r===100){let i=m.getBranchCoverageByLine();s=Object.entries(i).map(([c,{coverage:u}])=>[c,u===100])}else s=Object.entries(m.getLineCoverage());let l=!0;return s.reduce((i,[c,u])=>{if(u)l=!0;else{let h=parseInt(c);l?(i.push([h]),l=!1):i[i.length-1][1]=h}return i},[])}var C=["Statements","Branches","Functions","Lines"],a=class extends w.ReportBase{skipEmpty;skipFull;results={};cw=null;watermarks=null;constructor(e){super(e),this.skipEmpty=!!e.skipEmpty,this.skipFull=!!e.skipFull}onStart(e,n){if(!process.env.GITHUB_STEP_SUMMARY){console.log("Reporter not being executed in Github Actions environment");return}this.cw=d.default.createWriteStream(process.env.GITHUB_STEP_SUMMARY,{encoding:"utf-8",flags:"a"}),this.watermarks=n.watermarks,this.cw.write("<h2>Test Coverage</h2>"),this.cw.write("<table><thead><tr>");for(let r of["File",...C,"Uncovered Lines"])this.cw.write(`<th>${r}</th>`);this.cw.write("</tr></thead><tbody>")}onSummary(e){let n=e.getRelativeName()||"All Files",r=e.getCoverageSummary(!1),s=r.isEmpty();this.skipEmpty&&s||this.skipFull&&R(r)||(this.results[n]={statements:s?0:r.statements.pct,branches:s?0:r.branches.pct,functions:s?0:r.functions.pct,lines:s?0:r.lines.pct,uncoveredLines:L(e)})}onDetail(e){return this.onSummary(e)}formatter(e,n){if(!this.watermarks||this.watermarks[n]===void 0)return`<td>${e}%</td>`;let[r,s]=this.watermarks[n];return e<r?`<td><p style="color:red">${e}%</p></td>`:e>s?`<td><p style="color:green">${e}%</p></td>`:`<td><p style="color:yellow">${e}%</p></td>`}onEnd(){if(!this.cw)return;let e=Object.keys(this.results).sort();for(let n of e){let r=this.results[n];if(this.cw.write(`<tr><td><code>${n}</code></td>`),this.cw.write(this.formatter(r.statements,"statements")),this.cw.write(this.formatter(r.branches,"branches")),this.cw.write(this.formatter(r.functions,"functions")),this.cw.write(this.formatter(r.lines,"lines")),r.uncoveredLines.length>0){this.cw.write("<td><details><summary>Expand</summary><ul>");for(let s of r.uncoveredLines)s.length===1?this.cw.write(`<li>${s[0]}</li>`):this.cw.write(`<li>${s[0]}-${s[1]}</li>`);this.cw.write("</ul></details></td>")}else this.cw.write("<td></td>");this.cw.write("</tr>")}this.cw.write("</tbody></table>"),this.cw.close()}};
