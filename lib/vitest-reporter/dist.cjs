"use strict";var{ReportBase:u}=require("istanbul-lib-report");function m(s){return s.statements.pct===100&&s.branches.pct===100&&s.functions.pct===100&&s.lines.pct===100}function h(s){if(s.isSummary())return[];let e=s.getCoverageSummary(!1),t=e.isEmpty()?0:e.lines.pct,r,c=s.getFileCoverage();if(t===100){let i=c.getBranchCoverageByLine();r=Object.entries(i).map(([l,{coverage:a}])=>[l,a===100])}else r=Object.entries(c.getLineCoverage());let o=!0;return r.reduce((i,[l,a])=>{if(a)o=!0;else{let p=parseInt(l);o?(i.push([p]),o=!1):i[i.length-1][1]=p}return i},[])}var f=["Statements","Branches","Functions","Lines"];module.exports=class extends u{skipEmpty;skipFull;results={};cw=null;watermarks;constructor(e){super(e),this.skipEmpty=!!e.skipEmpty,this.skipFull=!!e.skipFull,this.watermarks=null}onStart(e,n){if(!process.env.GITHUB_STEP_SUMMARY){console.log("Reporter not being executed in Github Actions environment");return}this.cw=n.writer.writeFile(process.env.GITHUB_STEP_SUMMARY),this.watermarks=n.watermarks,this.cw.println("<h3>Test Coverage</h3>"),this.cw.println("<table><thead><tr>");for(let t of["File",...f,"Uncovered Lines"])this.cw.println(`<th>${t}</th>`);this.cw.println("</tr></thead><tbody>")}onSummary(e){let n=e.getRelativeName()||"All Files",t=e.getCoverageSummary(!1),r=t.isEmpty();this.skipEmpty&&r||this.skipFull&&m(t)||(this.results[n]={statements:r?0:t.statements.pct,branches:r?0:t.branches.pct,functions:r?0:t.functions.pct,lines:r?0:t.lines.pct,uncoveredLines:h(e)})}onDetail(e){return this.onSummary(e)}formatter(e,n){if(!this.watermarks)return`<td>${e}%</td>`;let[t,r]=this.watermarks[n];return e<t?`<td><p style="color:red">${e}%</p></td>`:e>r?`<td><p style="color:green">${e}%</p></td>`:`<td><p style="color:yellow">${e}%</p></td>`}onEnd(){if(!this.cw)return;let e=Object.keys(this.results).sort();for(let n of e){let t=this.results[n];if(this.cw.println(`<tr><td><code>${n}</code></td>`),this.cw.println(this.formatter(t.statements,"statements")),this.cw.println(this.formatter(t.branches,"branches")),this.cw.println(this.formatter(t.functions,"functions")),this.cw.println(this.formatter(t.lines,"lines")),t.uncoveredLines.length>0){this.cw.println("<td><details><summary>Expand</summary><ul>");for(let r of t.uncoveredLines)r.length===1?this.cw.println(`<li>${r[0]}</li>`):this.cw.println(`<li>${r[0]}-${r[1]}</li>`);this.cw.println("</ul></details></td>")}else this.cw.println("<td></td>");this.cw.println("</tr>")}this.cw.println("</tbody></table>"),this.cw.close()}};
