import f from"fs/promises";import c from"path";import*as e from"@actions/core";import{getExecOutput as l}from"@actions/exec";async function p(s,i){let a=[];async function*r(t,n){if(i!==void 0&&n>=i)return;let m=await f.readdir(t,{withFileTypes:!0});for(let o of m){let u=c.join(t,o.name);if(o.isFile()){if(o.name==="package.json")try{let{default:{name:d}}=await import(u,{with:{type:"json"}});if(d){yield{name:d,directory:t};return}}catch{}continue}o.isDirectory()&&o.name!=="node_modules"&&!o.name.startsWith("__")&&(yield*r(u,n+1))}}for await(let t of r(s,0))a.push(t);return a}async function y(){let{stdout:s}=await l("git",["rev-parse","--show-toplevel"]),i=s.trim(),a=e.getInput("type",{required:!0}),r;switch(a){case"libs":{r=c.join(i,"lib");break}case"bundles":{r=c.join(i,"src","bundles");break}case"tabs":{r=c.join(i,"src","tabs");break}default:{e.error(`Invalid package type: ${a}. Must be lib, bundles or tabs`);return}}let t=await p(r);e.setOutput(a,t),e.summary.addHeading(`Found ${a}`),e.summary.addList(t.map(({name:n})=>n)),e.summary.write()}try{await y()}catch(s){e.setFailed(s.message)}
